<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Product Store</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
  header { background:#1e90ff; color:white; padding:20px; text-align:center; }
  main { display:flex; flex-wrap:wrap; justify-content:center; padding:20px; min-height:80vh; }
  .product { background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2); width:200px; margin:15px; padding:15px; display:flex; flex-direction:column; justify-content:space-between; }
  .product h3 { margin:0 0 10px 0; }
  .product p { margin:0 0 15px 0; }
  .product button { padding:10px; background:#1e90ff; color:white; border:none; border-radius:5px; cursor:pointer; }
  .cart { position:fixed; top:20px; right:20px; background:white; border-radius:8px; padding:15px; width:250px; max-height:80vh; overflow-y:auto; box-shadow:0 2px 5px rgba(0,0,0,0.3); }
  .cart h3 { margin-top:0; }
  .cart-item { display:flex; justify-content:space-between; margin:5px 0; }
  #loginDiv, #otpDiv { text-align:center; margin:50px auto; background:white; padding:30px; width:300px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
  input { padding:10px; width:90%; margin:10px 0; border-radius:5px; border:1px solid #ccc; }
  button { cursor:pointer; }
</style>
</head>
<body>

<header>
  <h1>My Product Store</h1>
  <div id="userInfo"></div>
</header>

<!-- Login -->
<div id="loginDiv">
  <h2>Login with Phone</h2>
  <input type="text" id="phoneNumber" placeholder="+91XXXXXXXXXX"/>
  <div id="recaptcha-container"></div>
  <button onclick="sendOTP()">Send OTP</button>
</div>

<div id="otpDiv" style="display:none;">
  <h2>Enter OTP</h2>
  <input type="text" id="otp" placeholder="Enter OTP"/>
  <button onclick="verifyOTP()">Verify OTP</button>
</div>

<main id="products" style="display:none;"></main>

<!-- Cart -->
<div class="cart" id="cartDiv" style="display:none;">
  <h3>Cart</h3>
  <div id="cartItems"></div>
  <p><strong>Subtotal: ₹<span id="subtotal">0</span></strong></p>
  <button onclick="payNow()">Pay Now</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB6zy6f_7h4AwYk6LSlYfhptXOhhbJxqjY",
  authDomain: "phone-number-a7cde.firebaseapp.com",
  projectId: "phone-number-a7cde",
  storageBucket: "phone-number-a7cde.firebasestorage.app",
  messagingSenderId: "759284052900",
  appId: "1:759284052900:web:a8e57beedd905ac0e1c731",
  measurementId: "G-ZKL02TQ6JT"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

// Products
const productsData = [
  {name:'Bag', price:4},
  {name:'T-Shirt', price:4000},
  {name:'Shirt', price:5000},
  {name:'Pen', price:400},
  {name:'Books', price:6000},
  {name:'Trouser', price:3000},
  {name:'Pants', price:2000}
];

// Cart
let cart = [];

function renderProducts() {
  const container = document.getElementById('products');
  container.innerHTML = '';
  productsData.forEach((p,i)=>{
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `<h3>${p.name}</h3><p>₹${p.price}</p><button onclick="addToCart(${i})">Add to Cart</button>`;
    container.appendChild(div);
  });
}

function addToCart(index){
  cart.push(productsData[index]);
  renderCart();
}

function removeFromCart(index){
  cart.splice(index,1);
  renderCart();
}

function renderCart(){
  const cartDiv = document.getElementById('cartItems');
  cartDiv.innerHTML='';
  cart.forEach((item,i)=>{
    const div = document.createElement('div');
    div.className='cart-item';
    div.innerHTML = `<span>${item.name} - ₹${item.price}</span><button onclick="removeFromCart(${i})">Remove</button>`;
    cartDiv.appendChild(div);
  });
  const subtotal = cart.reduce((sum,i)=>sum+i.price,0);
  document.getElementById('subtotal').innerText=subtotal;
}

// Pay Now
function payNow(){
  if(cart.length===0){ alert('Cart is empty'); return; }
  const subtotal = cart.reduce((sum,i)=>sum+i.price,0);
  const upiLink = `upi://pay?pa=9667200280@fam&pn=StoreOwner&am=${subtotal}&cu=INR`;
  window.location.href = upiLink;
}

// Firebase Phone Auth
function sendOTP() {
  const phoneNumber = document.getElementById("phoneNumber").value;
  const appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {size: 'invisible'});
  firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
    .then(confirmationResult => {
      window.confirmationResult = confirmationResult;
      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("otpDiv").style.display = "block";
    })
    .catch(error => alert(error.message));
}

function verifyOTP() {
  const code = document.getElementById("otp").value;
  window.confirmationResult.confirm(code)
    .then(result => {
      const user = result.user;
      document.getElementById("otpDiv").style.display = "none";
      document.getElementById("products").style.display = "flex";
      document.getElementById("cartDiv").style.display = "block";
      document.getElementById("userInfo").innerText = "Logged in as: " + user.phoneNumber;
      renderProducts();
    })
    .catch(error => alert(error.message));
}
</script>
</body>
</html>
